{% extends 'base_backend.html' %}

{% load blog_tags %}
{% load common_tags %}

{% block head_title %}Create Your Blog{% endblock %}

{% block html_head %}
<script src="{{STATIC_URL}}libs/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="{{STATIC_URL}}libs/load-image.min.js" type="text/javascript"></script>

{% location_js %}

{% textcounter_js %}

<script type="text/javascript">
$(document).ready(function() {
  var fileInputs = $('input[type=file]');
  var load = function(e) {
    var preview = $(this).siblings('.image-preview');
    e = e.originalEvent;
    e.preventDefault();
    window.loadImage(
      (e.dataTransfer || e.target).files[0],
      function (img) {
        preview.children().remove().end().append(img).addClass('block');
      },
      {
        maxWidth: 470,
        canvas: false
      }
    );
  };
  $('input[type=file]').on('change', load);
});
</script>

{% endblock %}

{% block nav %}
{% endblock %}

{% block content %}
<form class="form-horizontal" method="post" action="{{ action }}" enctype="multipart/form-data">
  {% csrf_token %}
  <fieldset>
    <legend>Create Your Blog</legend>
    
    <div class="control-group{% if form.title.errors %} error{% endif %}">
      <label class="control-label" for="id_title">Title</label>
      <div class="controls">
        {{ form.title }}
        {% if form.title.errors %}
        <span class="help-inline">{{ form.title.errors.as_text }}</span>
        {% endif %}
      </div>
    </div>
    
    <div class="control-group{% if form.image.errors %} error{% endif %}">
      <label class="control-label" for="id_image">Image</label>
      <div class="controls">
        <div class="image-preview">
        {% if blog.image %}
        <img src="{{ blog.image|scale:'470x1000' }}" class="block" />
        {% endif %}
        </div>
        {{ form.image }}
        {% if form.image.errors %}
        <span class="help-inline">{{ form.image.errors.as_text }}</span>
        {% endif %}
      </div>
    </div>
    
    <div class="control-group{% if form.description.errors %} error{% endif %}">
      <label class="control-label" for="id_description">Description</label>
      <div class="controls">
        {{ form.description }}
        {{ form.description.errors }}
        <p class="help-block"><span id="id_description_counter">-1</span> characters left.</p>
      </div>
    </div>
    
    <div class="control-group{% if form.country.errors or form.city.errors %} error{% endif %}">
      <label class="control-label" for="id_country">Location</label>
      <div class="controls">
        {{ form.country }}
        {{ form.city }}
        {% if form.country.errors or form.city.errors %}
        <span class="help-inline">* Please enter both fields.</span>
        {% endif %}
        <p class="help-block">Ex. Japan, Brazil, Liverpool, Bangkok</p>
      </div>
    </div>
    
    <div class="control-group{% if form.mood.errors %} error{% endif %}">
      <label class="control-label" for="mood_1">Mood</label>
      <div class="controls"> 
        {% for value, text in moods %}
        <label class="radio">
          <input type="radio" id="mood_{{ value }}" value="{{ value }}" name="mood"{% ifequal form.mood.data value|lower %} checked="checked"{% endifequal %}> <span class="emo_{{ text|lower }} emoticon"></span>{{ text }}
        </label>
        {% endfor %}
        {% if form.mood.errors %}
        <p class="help-block">{{ form.mood.errors.as_text }}</p>
        {% endif %}
      </div>
    </div>
    
    <div class="control-group">
      <label class="control-label" for="id_category">Category</label>
      <div class="controls">
        {{ form.category }}
      </div>
    </div>
    
    <div class="control-group{% if form.private.errors %} error{% endif %}">
      <label class="control-label" for="visibility_0">Visibility</label>
      <div class="controls">
        {% for value, text in visibilities %}
        <label class="radio">
          <input type="radio" id="visibility_{{ value|yesno:"1,0"}}" name="private" value="{{ value|yesno:"1,0"}}"{% ifequal value|yesno:"1,0" form.private.data %} checked="checked"{% endifequal %}>
          {{ text }}
        </label>
        {% endfor %}
        {% if form.private.errors %}
        <p class="help-block">{{ form.private.errors.as_text }}</p>
        {% endif %}
      </div>
    </div>
    
    <div class="form-backend">
      {% if is_draft %}
      <button type="submit" class="btn-grey" name="draft" value="1">Save Draft</button>
      {% endif %}
      {% if is_draft %}
      <button type="submit" class="btn-green" name="draft" value="0">Publish</button>
      {% else %}
      <button type="submit" class="btn-green" name="draft" value="0">Save changes</button>
      {% endif %}
      <button type="reset" class="btn">Cancel</button>
    </div>
  </fieldset>
</form>
{% endblock %}